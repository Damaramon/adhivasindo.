openapi: 3.0.3
info:
  title: CAREER BackEnd API
  version: 1.0.0
servers:
  - url: http://localhost:4000

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

paths:
  /health:
    get:
      summary: Health check
      responses:
        "200":
          description: OK

  /api/auth/login:
    post:
      summary: Login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, example: admin@example.com }
                password: { type: string, example: Admin12345! }
      responses:
        "200":
          description: Success
        "401":
          description: Invalid credentials

  /api/users:
    get:
      summary: List users (admin only)
      security:
        - bearerAuth: []
      responses:
        "200": { description: OK }
        "401": { description: Unauthorized }
        "403": { description: Forbidden }
    post:
      summary: Create user (admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [name, email, password]
              properties:
                name: { type: string, example: Test User }
                email: { type: string, example: test.user@example.com }
                password: { type: string, example: Password123! }
                role: { type: string, example: user }
                is_active: { type: boolean, example: true }
      responses:
        "201": { description: Created }
        "409": { description: Email already exists }

  /api/users/{id}:
    get:
      summary: Get user by id (admin only)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        "200": { description: OK }
        "404": { description: Not found }
    put:
      summary: Update user (admin only)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                email: { type: string }
                password: { type: string }
                role: { type: string }
                is_active: { type: boolean }
      responses:
        "200": { description: Updated }
        "404": { description: Not found }
    delete:
      summary: Delete user (admin only)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        "200": { description: Deleted }
        "404": { description: Not found }

  /api/search/name/{nama}:
    get:
      summary: Search remote by NAMA (protected)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: nama
          required: true
          schema: { type: string }
          example: Turner Mia
      responses:
        "200": { description: OK }

  /api/search/nim/{nim}:
    get:
      summary: Search remote by NIM (protected)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: nim
          required: true
          schema: { type: string }
          example: "9352078461"
      responses:
        "200": { description: OK }

  /api/search/ymd/{ymd}:
    get:
      summary: Search remote by YMD (protected)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: ymd
          required: true
          schema: { type: string }
          example: "20230405"
      responses:
        "200": { description: OK }